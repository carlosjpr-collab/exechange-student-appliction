<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
	integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<!-- awsme icon -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
	integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
<title></title>
</head>

<div id="HomeStudent_apply" class="container-fluid">
	<div class="row">
  <div th:insert="~{nav :: copy}"></div>	</div>
	<div class="row">
		<form class="form-inline mt-2 mt-md-0">
			<input v-model="search" class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
			<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
		</form>
	</div>
	<div class="container">
		<div class="row">
			<br>
		</div>
		<div class="row">
			<div class="col-md-4 .col-lg-4">
				<input v-model="search" type="Search" class="form-control ds-input" id="search-input" placeholder="Search..." autocomplete="off"
					spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="false"
					aria-owns="algolia-autocomplete-listbox-0" dir="auto">
			</div>
		</div>
		<div class="row">
			<br>
		</div>
<div class="row">
	<div class="list-group">
		<button type="button" class="list-group-item list-group-item-action active">List of university</button>
		</div>
</div>

		<div class="row"  >
			<div  class="col-md-4 .col-lg-4">
			<div id="listofUniversity" v-for="(university,index) in filteredList"  @click="openbox(index)">
				<div class="list-group">
					<button   type="button" class="list-group-item list-group-item-action">
						{{university.name}} <i class="fas fa-chevron-right"></i>
					</button>
				</div> <br>
			</div>
		</div>

			<div  class="col-md-8 .col-lg-8">
				<div v-if="showUniversityActive" class="list-group-item">
					<div>
						<h2>
							{{universityName}} </br>
						</h2>
					</div>
					<div>
						Country: {{universityCountry}} <br>
					</div>
					<div>
						City: {{universityCity}} <br>
					</div>
					<div>
						Website: <a v-bind:href="website">{{universityUrl}}</a>
					</div>
					<div>
					Courses offered:
					<div v-for="course in universityCourses">{{course.name}} </div>
					</div>
					 <br>

					<div class="checkbox">
						You must share your information with the university that you will apply.
						<br>
		      <label><input v-model='acceptV' type="checkbox" value=""> Accept sharing policy </input></label>
	        </div>
					<div>
						<button type="button" :disabled="acceptPolicy" data-toggle="modal" data-target="#exampleModal" class="btn btn-primary" @click="apply(universityId)"> Apply</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal for Policy -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel"> Confirmation message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Your application has been submitted! <br>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

      </div>
    </div>
  </div>
</div>
	<footer class="footer">
		<nav class="navbar fixed-bottom navbar-expand-sm navbar-light bg-light">
			<p>&copy; Team 2018</p>
		</nav>
	</footer>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">
var app = new Vue({
   el: '#HomeStudent_apply',
   data: {
		 universityName:"par default",
		 search:"",
         list_university: [],
		 acceptV:false,
		 universityId:"par default",
		 universityCountry:"par default",
		 universityCity:"par default",
		 universityUrl:"par default",
		 universityCourses:"par default",
		 showUniversityActive:false
			 },
	 computed: {
		 acceptPolicy(){
			return !this.acceptV;
		 },
    filteredList() {
      return this.list_university.filter(university => {
        return university.name.toLowerCase().includes(this.search.toLowerCase())
      })
    }},
   methods:{
	   apply: function(id){
			 console.log(id);
			axios({
				method: 'put',
				url: '/service/application',
				data:JSON.stringify({
					"idUniv" : id,
					"agreement" : 1,
					"status" : "wait insa"
					} ),
                headers:{'Content-Type': 'application/json; charset=utf-8'}
			})},

		 openbox: function(index){
			 	var self=this;
			    this.acceptV=false;
			 	this.showUniversityActive=true;
			 	this.universityName=this.list_university[index].name;
				this.universityId=this.list_university[index].id;
				this.universityCity=this.list_university[index].city;
				this.universityUrl=this.list_university[index].url;
				this.universityCountry=this.list_university[index].country;
				axios.get('/service/course?id='+this.list_university[index].id,{port:8080})
	      .then(function (response) {
	    	  self.universityCourses=response.data;
			})},

		 getStarting: function() {
	  	self=this;
      axios.get('/service/university',{port:8080})
  .then(function (response) {
	 self.list_university=response.data;
	 self.list_university.forEach(function(element) { element.active = false; });
   console.log(self.list_university);
  })
  .catch(function (error) {
    // handle error
    console.log(error);
  })
  .then(function () {
    // always executed
  });
       }
 },
 beforeMount(){
    this.getStarting()
 },
 })
</script>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
	integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
	integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
	integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
</body>
</html>
